# ุฑุงูููุง ูพุงฺฉุณุงุฒ ุฎูุฏฺฉุงุฑ ูุงฺฏโูุง KNP

ุงู ูุฌููุนู ูุงูโูุง ุจุฑุง ูพุงฺฉุณุงุฒ ุฎูุฏฺฉุงุฑ ูุงฺฏโูุง ูุฏู ุณุณุชู KNP ุทุฑุงุญ ุดุฏู ุงุณุช.

## ูุงูโูุง ููุฌูุฏ

- `cleanup_logs.js` - ุงุณฺฉุฑูพุช ุงุตู ูพุงฺฉุณุงุฒ (Node.js)
- `cleanup_logs.sh` - wrapper script ุจุฑุง ุงุฌุฑุง ุขุณุงู
- `setup_cron.sh` - ุชูุธู ุฎูุฏฺฉุงุฑ Cron Job
- `CLEANUP_README.md` - ุงู ุฑุงูููุง

## ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### 1. ูุตุจ ุงููู

```bash
# ุฑูุชู ุจู ุฏุงุฑฺฉุชูุฑ ูพุฑูฺู
cd /path/to/knp

# ูุงุจู ุงุฌุฑุง ฺฉุฑุฏู ูุงูโูุง
chmod +x cleanup_logs.sh
chmod +x setup_cron.sh

# ูุตุจ ูุงุจุณุชฺฏโูุง (ุงฺฏุฑ ูุจูุงู ูุตุจ ูุดุฏู)
npm install mongodb
```

### 2. ุชุณุช ุฏุณุช

```bash
# ูพุงฺฉุณุงุฒ ูุงฺฏโูุง ูุฏูโุชุฑ ุงุฒ 30 ุฑูุฒ (ูพุดโูุฑุถ)
./cleanup_logs.sh

# ูพุงฺฉุณุงุฒ ูุงฺฏโูุง ูุฏูโุชุฑ ุงุฒ 60 ุฑูุฒ
./cleanup_logs.sh 60

# ุงุฌุฑุง ูุณุชูู ุจุง Node.js
node cleanup_logs.js 30
```

### 3. ุชูุธู ูพุงฺฉุณุงุฒ ุฎูุฏฺฉุงุฑ

```bash
# ุชูุธู Cron Job ุจุฑุง ูพุงฺฉุณุงุฒ ุฑูุฒุงูู
./setup_cron.sh

# ุง ุจุง ุชุนุฏุงุฏ ุฑูุฒูุง ุฏูุฎูุงู
./setup_cron.sh 45
```

## ุงุณุชูุงุฏู

### ูพุงฺฉุณุงุฒ ุฏุณุช

```bash
# ูพุงฺฉุณุงุฒ ุจุง ุชูุธูุงุช ูพุดโูุฑุถ (30 ุฑูุฒ)
./cleanup_logs.sh

# ูพุงฺฉุณุงุฒ ุจุง ุชุนุฏุงุฏ ุฑูุฒูุง ุฏูุฎูุงู
./cleanup_logs.sh 60
```

### ุจุฑุฑุณ ูุถุนุช

```bash
# ุจุฑุฑุณ Cron Jobs
crontab -l

# ูุดุงูุฏู ูุงฺฏโูุง ูพุงฺฉุณุงุฒ
tail -f /var/log/knp_cleanup.log

# ุจุฑุฑุณ ุชุนุฏุงุฏ ูุงฺฏโูุง ุจุงูโูุงูุฏู ุฏุฑ ุฏุชุงุจุณ
docker exec mongo-knp mongosh KN_PANEL --eval "db.logs.countDocuments()"
```

### ุญุฐู Cron Job

```bash
# ูุฑุงุด Cron Jobs
crontab -e

# ุญุฐู ุฎุท ูุฑุจูุท ุจู cleanup_logs.sh
```

## ุชูุธูุงุช ูพุดุฑูุชู

### ุชุบุฑ ุฒูุงู ุงุฌุฑุง

ุจุฑุง ุชุบุฑ ุฒูุงู ุงุฌุฑุงุ ูุงู `setup_cron.sh` ุฑุง ูุฑุงุด ฺฉูุฏ:

```bash
# ูุซุงู: ุงุฌุฑุง ูุฑ 6 ุณุงุนุช
0 */6 * * * /path/to/cleanup_logs.sh 30

# ูุซุงู: ุงุฌุฑุง ููุท ุฏุฑ ุขุฎุฑ ููุชู
0 2 * * 0 /path/to/cleanup_logs.sh 30
```

### ูพุงฺฉุณุงุฒ ููุดููุฏ

ุจุฑุง ูพุงฺฉุณุงุฒ ููุดููุฏโุชุฑุ ูโุชูุงูุฏ `cleanup_logs.js` ุฑุง ูุฑุงุด ฺฉูุฏ:

```javascript
// ุญุฐู ูุงฺฏโูุง ุณุณุชู ูุฏูโุชุฑ ุงุฒ 7 ุฑูุฒ
const syslogResult = await logs.deleteMany({
    is_syslog: 1,
    time: { $lt: Math.floor(Date.now() / 1000) - (7 * 24 * 60 * 60) }
});

// ุญุฐู ูุงฺฏโูุง ูุงฺฏู ูุฏูโุชุฑ ุงุฒ 14 ุฑูุฒ
const loginResult = await logs.deleteMany({
    action: "LOGIN",
    time: { $lt: Math.floor(Date.now() / 1000) - (14 * 24 * 60 * 60) }
});
```

## ุนุจโุงุจ

### ุฎุทุงูุง ุฑุงุฌ

1. **ุฎุทุง ุงุชุตุงู ุจู MongoDB:**
   ```bash
   # ุจุฑุฑุณ ูุถุนุช ฺฉุงูุชูุฑ MongoDB
   docker ps | grep mongo
   
   # ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ ุงฺฏุฑ ูุงุฒ ุจุงุดุฏ
   docker restart mongo-knp
   ```

2. **ุฎุทุง ุฏุณุชุฑุณ:**
   ```bash
   # ุจุฑุฑุณ ูุฌูุฒูุง ูุงู
   ls -la cleanup_logs.sh
   
   # ุชูุธู ูุฌูุฒูุง
   chmod +x cleanup_logs.sh
   ```

3. **ุฎุทุง Node.js:**
   ```bash
   # ุจุฑุฑุณ ูุณุฎู Node.js
   node --version
   
   # ูุตุจ ูุงุจุณุชฺฏโูุง
   npm install mongodb
   ```

### ุจุฑุฑุณ ูุงฺฏโูุง

```bash
# ูุดุงูุฏู ูุงฺฏโูุง ุณุณุชู
journalctl -u your-service-name

# ูุดุงูุฏู ูุงฺฏโูุง ูพุงฺฉุณุงุฒ
cat /var/log/knp_cleanup.log

# ูุดุงูุฏู ูุงฺฏโูุง MongoDB
docker logs mongo-knp
```

## ูฺฉุงุช ููู

- โ๏ธ **ูุดุฏุงุฑ:** ูพุงฺฉุณุงุฒ ูุงฺฏโูุง ุนููุงุช ุบุฑูุงุจู ุจุงุฒฺฏุดุช ุงุณุช
- ๐ **ุชูุตู:** ุงุจุชุฏุง ุจุง ุชุนุฏุงุฏ ุฑูุฒูุง ุฒุงุฏ ุชุณุช ฺฉูุฏ
- ๐ **ุงููุช:** ูุทูุฆู ุดูุฏ ฺฉู ุฏุณุชุฑุณโูุง ููุงุณุจ ุชูุธู ุดุฏูโุงูุฏ
- ๐ **ูุงูุชูุฑูฺฏ:** ูุงฺฏโูุง ูพุงฺฉุณุงุฒ ุฑุง ุจู ุทูุฑ ููุธู ุจุฑุฑุณ ฺฉูุฏ

## ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:
1. ูุงฺฏโูุง ุฎุทุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. ุชูุธูุงุช Cron ุฑุง ุจุฑุฑุณ ฺฉูุฏ
3. ุงุชุตุงู ุจู MongoDB ุฑุง ุชุณุช ฺฉูุฏ
4. ูุฌูุฒูุง ูุงูโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ
